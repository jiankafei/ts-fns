<!DOCTYPE html>

<link rel="stylesheet" href="https://unpkg.com/mocha@6.1.4/mocha.css" />

<div id="mocha"></div>

<script src="https://unpkg.com/mocha@6.1.4/mocha.js"></script>
<script src="https://unpkg.com/chai@4.2.0/chai.js"></script>
<script type="module">
import {
  createProxy,
  formatDate,
  fixNumber,
  merge,
  assign,
  parse,
  num10to62,
  num62to10,
} from '../src/index.js'

const expect = chai.expect
mocha.setup('bdd')

describe('proxy', () => {
  it('createProxy', () => {
    const data = {
      name: 'tomy',
      age: 10,
      weight: 20,
      body: {
        hand: 20,
        foot: 50,
      },
    }
    const state = createProxy(data, {
      // get([data, keyPath], [target, key, value]) {},
      set([data, keyPath], [target, key, value]) {
        if (keyPath === 'age') {
          target.weight = value * 2
        }
        else if (keyPath === 'body.hand') {
          target.foot = value * 2.5
        }
        return true
      },
      // del([data, keyPath], [target, key]) {},
    })

    state.age = 4
    expect(state.weight).to.equal(8)

    state.body.hand = 22
    expect(state.body.foot).to.equal(55)
  })
})

describe('date', () => {
  it('formatDate', () => {
    const date = formatDate('2019/12/04 12:30', 'YYYY-MM-DD s', 'YYYY/MM/DD HH:mm')
    expect(date).to.equal('2019-12-04 0')

    const d2 = new Date('2019-02-12 08:09:23')
    const date2 = formatDate(d2, 'YY-MM')
    expect(date2).to.equal('19-02')

    const date3 = formatDate('2019-12-04 12:30', 'DD\\D')
    expect(date3).to.equal('04D')

    const date4 = formatDate('2019-06-27 08:32 pm', 'HH:mm', 'YYYY-MM-DD hh:mm a')
    expect(date4).to.equal('20:32')

    const date5 = formatDate('Jun', 'MM', 'MMM')
    expect(date5).to.equal('06')

    const date6 = formatDate('2019-02-12 08:09:23.037', 'S')
    expect(date6).to.equal('37')
    const date7 = formatDate('2019-02-12 08:09:23.037', 'SSS')
    expect(date7).to.equal('037')

    // the ms .37 means .370 in fact
    const date61 = formatDate('2019-02-12 08:09:23.37', 'S')
    expect(date61).to.equal('370')
    const date71 = formatDate('2019-02-12 08:09:23.37', 'SSS')
    expect(date71).to.equal('370')
  })
})

describe('number', () => {
  it('fixNumber', () => {
    const num = '12.351'
    expect(fixNumber(num)).to.equal('12.35')
    expect(fixNumber(num, 1)).to.equal('12.4')
  })
  it('num10to62', () => {
    expect(num10to62(100)).to.equal('1C')
  })
  it('num62to10', () => {
    expect(num62to10('1C')).to.equal(100)
  })
})

describe('merge', () => {
  it('merge', () => {
    const obj1 = {
      body: {
        left: true,
      },
    }
    const obj2 = {
      body: {
        right: true,
      },
    }
    const obj = merge(obj1, obj2)
    expect(obj.body.left).to.equal(true)
    expect(obj.body.right).to.equal(true)
  })
})

describe('assign', () => {
  it('deep array item object', () => {
    const data = {
      data: {
        books: [
          {
            name: 'ok',
            price: 10,
          }
        ]
      }
    }
    assign(data, 'data.books[0].price', 0)
    expect(parse(data, 'data.books[0].price')).to.equal(0)
  })
})

mocha.run()
</script>
